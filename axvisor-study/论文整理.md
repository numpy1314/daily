# 一、研究背景与目标总结
三篇论文均聚焦 **​​Type-1 Hypervisor（裸机虚拟机监控器）​** ​的设计与实现，采用​​Rust语言​​开发以提升安全性和性能，目标是为嵌入式或轻量化场景提供高效虚拟化支持。以下是各论文的核心要点：
## 1.LoongArch（西北工业大学）
- 实现​ **​NPULoongvisor** ​​，首个基于龙芯LoongArch指令集的Type-1 VMM。
- 支持LVZ硬件虚拟化扩展，可运行Linux和轻量OS（如NPUCore）。
- 核心挑战：LoongArch虚拟化生态不成熟，需适配UEFI固件和硬件中断控制器。
- 验证平台：龙芯3A5000主板。
- 架构图展示整体设计：![](/pic/loong_arch.png)
## 2.ARMv8（清华大学）
- 实现​ **​rHyper** ​​，支持ARMv8硬件虚拟化（EL2特权级）。
- 可运行实时OS（NimbOS）、Unikernel（ArceOS）和Linux，强调静态资源划分。
- 核心挑战：优化中断虚拟化和设备直通性能。
- 验证平台：QEMU模拟器。
- 架构图展示多虚拟机支持：![](/pic/arm_arch.png)
## 3.RISC-C(天津大学)
- 实现两版VMM：​​hypocaust​​（纯软件虚拟化）和​​hypocaust-2​​（硬件辅助）。
- 支持RISC-V Hypervisor Extension，可运行Linux、RT-Thread和rCore-Tutorial。
- 核心挑战：RISC-V虚拟化扩展生态薄弱，需模拟PLIC中断控制器。
- 验证平台：QEMU（因无硬件流片）。
- 架构图对比两版设计：![](/pic/risc-v-arch.png)
# 二、核心虚拟化技术相同点
三架构均依赖​​硬件辅助虚拟化​​和​​统一设计范式​​，具体相同点如下：
## 1. 虚拟化类型与目标
- 均实现​​Type-1 Hypervisor​​，直接运行于裸机，无需宿主OS。
- 核心目标：轻量化、低延迟、资源隔离（如CPU/内存分区）。
- 均面向​​嵌入式场景​​（如传感器管理、实时任务），支持运行Linux及轻量OS。
## 2.​​CPU虚拟化机制
- ​​vCPU调度​​：均支持vCPU抽象，通过上下文切换（保存GPRs、CSR寄存器）实现多虚拟机调度。
- ​敏感指令处理​​：依赖硬件触发下陷（Trap），由Hypervisor模拟特权指令（如写页表基址寄存器）。
- ARMv8的EL2异常处理流程与LoongArch的LVZ陷入逻辑高度相似。(感觉我们写这部分可以参考arm的)
## 3.内存虚拟化技术
- 均采用​​两阶段地址翻译​​（GVA→GPA→HPA）：
  - LoongArch通过LVZ扩展实现硬件加速。
  - ARMv8使用Stage-2页表（VTTBR_EL2）。
  - RISC-V依赖Hypervisor Extension（hgatp寄存器）。
- 翻译流程对比图（通用模型）：![](/pic/translate-address.png)
## 4.​​I/O与中断虚拟化
- ​​I/O虚拟化​​：均支持设备直通（Passthrough）和模拟（Emulation）。
  - 直通：用于高性能场景（如网卡），但需地址翻译（如ARM SMMU/RISC-V IOMMU草案）。
  - 模拟：用于共享设备（如串口），通过MMIO拦截实现。
- 中断虚拟化​​：
  - 均需路由物理中断至虚拟机（如ARM GIC、RISC-V PLIC）。
  - 依赖中断注入机制（如LoongArch的CSR.ERA恢复、RISC-V的hvip寄存器）。
# 三、核心虚拟化技术不同点
三种架构在​​硬件支持​​、​​虚拟化扩展​​和​​实现复杂度​​上存在显著差异，具体如下表对比：
| 对比维度 | loongarch | armv8 | risc-v |
| --- | --- | --- | --- |
| **​硬件虚拟化扩展​​** | LVZ指令集（专用CSR和TLB管理） | EL2特权级 + Stage-2页表 | Hypervisor Extension（VS-mode + hgatp）|
| **内存虚拟化实现** | 强制两阶段翻译，无影子页表 | 两阶段翻译为主，影子页表可选 | 支持双模式：影子页表（hypocaust）/两阶段（hypocaust-2） |
| **中断控制器** | 自定义ExtIOI中断路由 | 通用中断控制器（GICv3） | PLIC模拟（因AIA支持不足） |
| **I/O虚拟化** | 依赖UEFI固件适配 | 需SMMU支持DMA重映射 | IOMMU未标准化，需恒等映射替代 |
| **特权级设计** | 三级模式（Host/Guest/Idle） | 四级特权级（EL0-EL3） | 可扩展模式（M/S/U + V-mode） |
| **多核设计** | SMP调度器（静态分区 + Round-Robin） | 静态vCPU绑定，无动态调度 | 依赖IPI核间通信 |
